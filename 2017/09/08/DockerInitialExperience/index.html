<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,minimum-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="Docker初体验"/>




  <meta name="keywords" content="docker," />





  <link rel="alternate" href="/atom.xml" title="Russell">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.1" />



<link rel="canonical" href="http://JohnneyAnn.github.io/2017/09/08/DockerInitialExperience/"/>


<meta name="description" content="Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。">
<meta name="keywords" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker初体验">
<meta property="og:url" content="http://JohnneyAnn.github.io/2017/09/08/DockerInitialExperience/index.html">
<meta property="og:site_name" content="Russell">
<meta property="og:description" content="Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://johnneyann.github.io/img/docker/dockerinfo.png">
<meta property="og:image" content="http://johnneyann.github.io/img/docker/hello.png">
<meta property="og:image" content="http://johnneyann.github.io/img/docker/dockerps.png">
<meta property="og:image" content="http://johnneyann.github.io/img/docker/nginx.png">
<meta property="og:image" content="http://johnneyann.github.io/img/docker/jpress.png">
<meta property="og:image" content="http://johnneyann.github.io/img/docker/jpresspage.png">
<meta property="og:updated_time" content="2017-09-08T13:01:33.771Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker初体验">
<meta name="twitter:description" content="Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。">
<meta name="twitter:image" content="http://johnneyann.github.io/img/docker/dockerinfo.png">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=1.1" />
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>


  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




<script type="text/javascript">
  var themeConfig = {
    fancybox: {
      enable: true
    },
  };
</script>




  



    <title> Docker初体验 - Russell </title>
  </head>

  <body>
    <div id="page">
      <header id="masthead"><div class="site-header-inner">
    <h1 class="site-title">
        <a href="/." class="logo">Russell</a>
    </h1>

    <nav id="nav-top">
        
            <ul id="menu-top" class="nav-top-items">
                
                    <li class="menu-item">
                        <a href="/archives">
                            
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li class="menu-item">
                        <a href="/about">
                            
                            
                                About
                            
                        </a>
                    </li>
                
            </ul>
        
  </nav>
</div>

      </header>
      <div id="content">
        
    <div id="primary">
        
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Docker初体验
        
      </h1>

      <time class="post-time">
          9月 08 2017
      </time>
    </header>



    
            <div class="post-content">
            <p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口。<br><a id="more"></a></p>
<h2 id="安装-Docker"><a href="#安装-Docker" class="headerlink" title="安装 Docker"></a>安装 Docker</h2><h3 id="保证Ubuntu软件源最新"><a href="#保证Ubuntu软件源最新" class="headerlink" title="保证Ubuntu软件源最新"></a>保证Ubuntu软件源最新</h3><pre><code class="bash">$ apt-get update
</code></pre>
<p>当前系统为Ubuntu16x64，root用户</p>
<h3 id="下载-docker"><a href="#下载-docker" class="headerlink" title="下载 docker"></a>下载 docker</h3><pre><code class="bash">$ apt-get install -y docker.io
</code></pre>
<p>下载完成后可使用docker version查看docker版本，正常会显示client以及server，由于未启动docker服务，此时只会显示client的信息，可执行第三步启动docker，再执行docker version即可正常显示，显示结果如下<br><img src="/img/docker/dockerinfo.png" alt="docker信息"></p>
<h3 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a>启动docker</h3><pre><code class="bash">$ service docker start
</code></pre>
<h3 id="拉取docker官网的镜像hello-world-名字需一致"><a href="#拉取docker官网的镜像hello-world-名字需一致" class="headerlink" title="拉取docker官网的镜像hello-world(名字需一致)"></a>拉取docker官网的镜像hello-world(名字需一致)</h3><pre><code class="bash">$ docker pull hello-world
</code></pre>
<h3 id="至此可查看镜像列表"><a href="#至此可查看镜像列表" class="headerlink" title="至此可查看镜像列表"></a>至此可查看镜像列表</h3><pre><code class="bash">$ docker images
</code></pre>
<h3 id="运行hello-world（前台运行）"><a href="#运行hello-world（前台运行）" class="headerlink" title="运行hello-world（前台运行）"></a>运行hello-world（前台运行）</h3><pre><code class="bash">$ docker run hello-world
</code></pre>
<p>运行结果如下图所示，从内容可看到hello-world的运行做了哪些事：<br><img src="/img/docker/hello.png" alt="hello-world"></p>
<h2 id="来试试其他镜像吧"><a href="#来试试其他镜像吧" class="headerlink" title="来试试其他镜像吧"></a>来试试其他镜像吧</h2><p>由于docker官网的镜像下载较慢，这里通过<a href="https://c.163.com/" target="_blank" rel="external">网易蜂巢中心</a>拉取镜像</p>
<h3 id="拉取nginx镜像"><a href="#拉取nginx镜像" class="headerlink" title="拉取nginx镜像"></a>拉取nginx镜像</h3><pre><code class="bash">$ docker pull hub.c.163.com/library/nginx:latest
</code></pre>
<h3 id="后台运行nginx"><a href="#后台运行nginx" class="headerlink" title="后台运行nginx"></a>后台运行nginx</h3><pre><code class="bash">$ docker run -d hub.c.163.com/library/nginx
</code></pre>
<p>后台运行将返回一个id，如：6b79dde…..</p>
<p>docker run –help 可查看可选的参数，-d参数表示后台运行</p>
<h3 id="查看运行的容器"><a href="#查看运行的容器" class="headerlink" title="查看运行的容器"></a>查看运行的容器</h3><pre><code class="bash">$ docker ps
</code></pre>
<p><img src="/img/docker/dockerps.png" alt="docker进程"></p>
<h3 id="当然可以进入容器内部"><a href="#当然可以进入容器内部" class="headerlink" title="当然可以进入容器内部"></a>当然可以进入容器内部</h3><pre><code class="bash">$ docker exec -it 6b /bin/bash
</code></pre>
<p>（6b为id简写，如果很容易识别id可以简写）</p>
<p>容器就像是一个虚拟的机器，进入后和linux没有区别，我把它就看成虚拟机了- -</p>
<h3 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h3><pre><code class="bash">$ exit
</code></pre>
<h2 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h2><p>部署项目当然需要进行外部访问，因此需要将当前机器与容器进行端口映射</p>
<p>我们先关闭nginx容器来便于后边的操作</p>
<h3 id="关闭nginx"><a href="#关闭nginx" class="headerlink" title="关闭nginx"></a>关闭nginx</h3><pre><code class="bash">$ docker stop 6b
</code></pre>
<h3 id="以桥接Bridge的方式启动nginx"><a href="#以桥接Bridge的方式启动nginx" class="headerlink" title="以桥接Bridge的方式启动nginx"></a>以桥接Bridge的方式启动nginx</h3><pre><code class="bash">$ docker run -d -p 9999:80 hub.c.163.com/library/nginx
</code></pre>
<p>其实就是配置端口映射，使用参数-p,具体端口可按实际需求指定</p>
<p>还有种映射方式，随机端口映射（使用参数-P），将映射容器的所有端口,我一般用第一种</p>
<pre><code class="bash">$ docker run -d -P hub.c.163.com/library/nginx
</code></pre>
<h3 id="查看端口是否启动"><a href="#查看端口是否启动" class="headerlink" title="查看端口是否启动"></a>查看端口是否启动</h3><pre><code class="bash">$ netstat -na|grep 9999
</code></pre>
<h3 id="现在就可以访问啦"><a href="#现在就可以访问啦" class="headerlink" title="现在就可以访问啦"></a>现在就可以访问啦</h3><p>去浏览器输入你的服务器ip配上刚刚的9999端口号就ok了</p>
<pre><code>IP:9999
</code></pre><p><img src="/img/docker/nginx.png" alt="nginx"></p>
<h2 id="自定义镜像"><a href="#自定义镜像" class="headerlink" title="自定义镜像"></a>自定义镜像</h2><p>这才是最重要的吧，自己写的项目如何用docker部署？</p>
<p>这里以Jpress为例吧，顺便说一下mysql部署</p>
<h3 id="下载jpress的war包"><a href="#下载jpress的war包" class="headerlink" title="下载jpress的war包"></a>下载jpress的war包</h3><p>进入<a href="http://jpress.io/" target="_blank" rel="external">Jpress官网</a>,点击下载跳转到github下载最新的war包：<br><img src="/img/docker/jpress.png" alt="jpress"></p>
<p>下载完成后防止到某个文件夹（如/home/username）,为了方便 重命名war包</p>
<pre><code class="bash">$ mv jpress-web-newest.war jpress.war
</code></pre>
<h3 id="拉取tomcat镜像"><a href="#拉取tomcat镜像" class="headerlink" title="拉取tomcat镜像"></a>拉取tomcat镜像</h3><pre><code class="bash">$ docker pull hub.c.163.com/library/tomcat:latest
</code></pre>
<p>因为要部署到tomcat中去，所以也拉个下来，tomcat镜像是自带JDK的，所以无需拉取java的镜像了</p>
<h3 id="编写Dockerfile"><a href="#编写Dockerfile" class="headerlink" title="编写Dockerfile"></a>编写Dockerfile</h3><pre><code class="bash">$ vim Dockerfile
</code></pre>
<p>Dockerfile就创建镜像的文件啦，若不在当前文件夹下，注意文件引入的路径</p>
<h3 id="填写内容"><a href="#填写内容" class="headerlink" title="填写内容"></a>填写内容</h3><pre><code class="bash">from hub.c.163.com/library/tomcat

MAINTAINER anyang  johnney**@163.com

COPY jpress.war /usr/local/tomcat/webapps
</code></pre>
<p>解释一下：这是基本配置</p>
<pre><code class="bash">from 引入tomcat镜像

MAINTAINER 镜像的所有者及联系方式，可不填

COPY 将创建的镜像拷贝到tomcat下，tomcat的具体路径可在镜像中心的镜像详情查看
</code></pre>
<h3 id="构建自定义镜像"><a href="#构建自定义镜像" class="headerlink" title="构建自定义镜像"></a>构建自定义镜像</h3><pre><code class="bash">$ docker build -t jpress:latest .
</code></pre>
<p>-t镜像名字及TAG  后面参数为镜像目录，.代表当前目录</p>
<p>创建完成后可查看自己的镜像：（docker images）</p>
<h3 id="运行自定义镜像"><a href="#运行自定义镜像" class="headerlink" title="运行自定义镜像"></a>运行自定义镜像</h3><pre><code class="bash">$ docker run -d -p 8888:8080 jpress
</code></pre>
<h3 id="拉取mysql镜像"><a href="#拉取mysql镜像" class="headerlink" title="拉取mysql镜像"></a>拉取mysql镜像</h3><p>由于Jpress的安装需要使用到数据库，因此有了下面的步骤</p>
<pre><code class="bash">$ docker pull hub.c.163.com/library/mysql:latest
</code></pre>
<h3 id="运行mysql镜像"><a href="#运行mysql镜像" class="headerlink" title="运行mysql镜像"></a>运行mysql镜像</h3><p>运行mysql是需要配置些数据库信息，如数据库密码（MYSQL_ROOT_PASSWORD）、需要创建的数据库（MYSQL_DATABASE）等，使用-e参数配键值对，更多参数可在镜像中心mysql镜像详情中查看。</p>
<pre><code class="bash">$ docker run -d -p 7777:3306 -e MYSQL_ROOT_PASSWORD=000000 -e MYSQL_DATABASE=jpress hub.c.163.com/library/mysql
</code></pre>
<h3 id="配置并重启jpress容器"><a href="#配置并重启jpress容器" class="headerlink" title="配置并重启jpress容器"></a>配置并重启jpress容器</h3><p>按照上面的参数以及Jpress页面提示的安装步骤，填写好相应的信息即可成功创建Jpress。</p>
<p>配置完成后，需要重启jpress容器（按照你的具体id）：</p>
<pre><code class="bash">$ docker restart 5e8caebf1643
</code></pre>
<h3 id="OK-访问吧"><a href="#OK-访问吧" class="headerlink" title="OK 访问吧!"></a>OK 访问吧!</h3><p>在浏览器输入IP:8888/jpress,结果如下</p>
<p><img src="/img/docker/jpresspage.png" alt="jpress页面"></p>

            </div>
          

    
      <footer class="post-footer">
		
		<div class="post-tags">
		  
			<a href="/tags/docker/">docker</a>
		  
		</div>
		

        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/09/08/I can't think back now/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">我现在已不敢往后想</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2017/09/08/AjaxCrossDomain/">
        <span class="next-text nav-default">Ajax跨域问题</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

        
  <div class="comments" id="comments">
    
  </div>


      </footer>
    
  </article>

    </div>

      </div>

      <footer id="colophon"><span class="copyright-year">
    
        &copy;
    
        2017 -
    
    2019
    <span class="footer-author">安 阳.</span>
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a> and <a class="theme-link" href="https://github.com/frostfan/hexo-theme-polarbear">Polar Bear</a>
    </span>
</span>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>
    


    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  

    <script type="text/javascript" src="/js/src/theme.js?v=1.1"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=1.1"></script>

  </body>
</html>
